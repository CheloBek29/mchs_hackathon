# Fire Physics + Nozzle Control Spec (from requirements)

Краткая спецификация для следующей итерации, собранная из файлов требований.

## 1. Что прямо требуют документы

Источник: `backend/Требования к продукту.txt`

- Физическая модель развития пожара на основе справочника.
- Расчет линейной скорости распространения `Vл`.
- Автоматический расчет площади `Sп` и периметра `Pп`.
- Учет ветра (скорость + направление).
- При вводе стволов: снижение скорости распространения, стабилизация/уменьшение площади.
- Выбор типа ствола и регулировка расхода воды.
- Отображение остатка воды/пенообразователя на технике.
- Расчет времени работы стволов и времени до исчерпания ОТВ.

Источник: `backend/Техническое задание по ПО «ТП-СИМУЛЯТОР».txt`

- Регулировка расхода воды на стволах.
- Ввод в действие стволов с выбором типа.
- Прокладка рукавных линий с вычетом длины/запаса.

## 2. Минимальный рабочий дизайн (MVP)

### 2.1 Сущности

- `FireObject`: источник пожара/дым, текущая площадь, периметр, скорость распространения.
- `NozzleDeployment` (через `ResourceDeployment` + `resource_data`):
  - `nozzle_type`: `RS50 | RS70 | DELTA | GPS600`
  - `flow_lps`: текущий расход (л/с)
  - `mode`: `ATTACK | PROTECTION`
  - `efficiency`: коэффициент 0..1 (зависит от дистанции и угла)
  - `source_vehicle_id`

### 2.2 Модель шага (каждую секунду)

1. Базовый рост пожара:
   - `V_base = f(fire_load_type)`
   - `V_wind = k_wind * wind_speed * cos(delta_azimuth)`
   - `V_spread = max(0, V_base + V_wind)`

2. Эффект тушения:
   - `Q_effective = sum(flow_lps * efficiency * agent_factor)` по активным стволам
   - `Q_required = q_norm * burning_area`
   - `suppression_ratio = clamp(Q_effective / Q_required, 0..2)`

3. Обновление площади:
   - если `suppression_ratio < 1`: пожар растет, но медленнее
   - если `suppression_ratio ~= 1`: стабилизация
   - если `suppression_ratio > 1`: площадь уменьшается

4. Расход ОТВ:
   - списание воды/пены с машины-источника по `flow_lps * dt`
   - при нуле воды ствол автоматически становится неэффективным

### 2.3 Параметры ствола на UI

Для каждого установленного ствола:

- тип ствола
- расход (слайдер в диапазоне типа)
- режим (`тушение` / `защита`)
- источник воды (машина/водоисточник)
- индикатор эффективности

## 3. Что вывести на интерфейс

- Для РТП/БУ:
  - текущий `Q_required` и `Q_effective`
  - прогноз: `рост / стабилизация / локализация`
  - время до исчерпания воды по каждой машине
- Для штаба:
  - графики `Sп(t)` и `Q(t)`

## 4. Критерии приемки

- Изменение расхода на стволе влияет на `Q_effective` в ту же секунду.
- При достаточном расходе площадь пожара перестает расти.
- При избытке расхода площадь пожара уменьшается.
- При нулевом остатке воды ствол перестает давать эффект.
- Все изменения синхронно видны всем ролям через realtime.
