# План Исправлений (BU/карта/UI)

Дата: 2026-03-01

## Этапы

- [x] Этап 0. Зафиксировать баги и критерии приемки.
- [x] Этап 1. BU-1/BU-2 не могут выполнять тактические действия, пока РТП не разместит их.
- [x] Этап 2. Исправить перекрытие интерфейса мини-картой.
- [x] Этап 3. Исправить смещение курсора на карте.
- [x] Этап 4. Добавить карточку характеристик по клику + параметры ствола (угол/давление).
- [x] Этап 5. Исправить перекрытие карты на экране статистики после занятия.
- [ ] Этап 6. Регрессия и приемка (backend/frontend + ручные сценарии по ролям).

## Критерии Этапа 1

- [x] Backend: BU-1/BU-2 получают отказ на тактические команды до постановки РТП-маркера `command_point=BU1/BU2`.
- [x] Frontend: BU-1/BU-2 видят обстановку, но кнопки тактических действий заблокированы до постановки РТП.
- [x] Добавлены тесты на блокировку и разблокировку после постановки РТП.

## Примечание

- Под "действиями" Этапа 1 считаются тактические операции с ресурсами на карте (размещение/изменение).

## Этап 6 — статус регрессии (2026-03-01)

- [x] Backend: `.venv-local/bin/python -m pytest -q` → `39 passed, 12 skipped`.
- [x] Frontend: `npm run lint` → без ошибок.
- [x] Frontend: `npm run build` → успешно (есть предупреждение Vite о размере чанка > 500 kB).
- [ ] Ручная приемка по ролям в UI (RTP/ШТАБ/БУ-1/БУ-2/Диспетчер) в браузере.

### Матрица ручной приемки (UI)

- [ ] BU-1/BU-2 до постановки РТП: кнопки размещения/действий недоступны, отображается предупреждение блокировки.
- [ ] RTP ставит `command_point=BU1/BU2`: для соответствующего БУ действия разблокируются.
- [ ] Тактическая карта: курсор/клик совпадают с точкой на канве при разных масштабах (`-`, `+`, wheel, pan).
- [ ] Клик по `VEHICLE`/`HOSE_LINE`/`NOZZLE`: открывается карточка характеристик по выбранному объекту.
- [ ] Для `NOZZLE`: доступны регулировки `spray_angle` и `pressure`, применение меняет значения в карточке/состоянии.
- [ ] После завершения урока (`COMPLETED`): мини-карта скрыта и не перекрывает экран статистики.
